<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: NewPlayer.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: NewPlayer.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
import { useState, useEffect } from 'react'
import { useSelector, useDispatch } from 'react-redux'
import { useNavigate } from 'react-router-dom'
import { toast } from 'react-toastify'

import { createPlayer, reset } from '../features/players/playerSlice'
import Spinner from '../components/Spinner'

/**
 * This function takes csv from local storage and read it. Then submit database button puts data to the database
 */

function NewPlayer() {
    const { user } = useSelector((state) => state.auth)
    const {isLoading, isError, isSuccess, message} = useSelector(
        (state) => state.players
    )
    //////////////////////////////////////////////////////////////////
    
    
    

    const [file, setFile] = useState();
    const [array, setArray] = useState([]);
    const [fullName, setPlayerName] = useState()
    const [team, setPlayerTeam] = useState()
    const [position, setPlayerPosition] = useState()
    const [raiting, setPlayerRaiting] = useState()
    const fileReader = new FileReader();
  
   


    const handleOnChangeCSV = (e) => {
      setFile(e.target.files[0]);
    };
  
    const csvFileToArray = string => {
      const csvHeader = string.slice(0, string.indexOf("\n")).split(";");
      const csvRows = string.slice(string.indexOf("\n") + 1).split("\n");
      //console.log(csvHeader)
      //console.log(csvRows)
      
      const array = csvRows.map(i => {
        const values = i.split(";");
        const obj = csvHeader.reduce((object, header, index) => {
            
          object[header] = values[index];
          
         
          return object;
        }, {});
        //console.log("196: " ,obj)
        return obj;
      });
      
      setArray(array);
    };

    function arrayToDb(){



    }
  
    const handleOnSubmitCSV = (e) => {
      e.preventDefault();
  
      if (file) {
        fileReader.onload = function (event) {
          const text = event.target.result;
          csvFileToArray(text);
        };
  
        fileReader.readAsText(file);
      }
    };
  
    const headerKeys = Object.keys(Object.assign({}, ...array));
    //console.log("211: " + headerKeys)
  


    /////////////////////////////////////////////////////////////////

   
    // const [name] = useState(user.name)
    // const [email] = useState(user.email)
    //const [file, setFile] = useState()


    const dispatch = useDispatch()
    const navigate = useNavigate()

    useEffect(() => {
        if(isError) {
            toast.error(message)
        }

        if(isSuccess) {
            
            navigate('/players')
        }

        
    }, [dispatch, isError, isSuccess, navigate, message])

    const onSubmit =(e) => {
        e.preventDefault()
        

        dispatch(createPlayer({fullName, team, position, raiting}))

    }

    const onSubmitDB = (e) => {
        e.preventDefault()
        for(let k=0; k &lt; Object.entries(array).length; k++){
            
           
            const fullName=Object.values(array)[k].Name
            const position= Object.values(array)[k].Position
            const team=Object.values(array)[k].Team
            const raiting =Object.values(array)[k].Rating
            dispatch(createPlayer({fullName, team, position, raiting}))
            
        }

    }

    if(isLoading) {
        return &lt;Spinner />
    }

    ///////////////////////////////////////

   


    
    return (
        &lt;>
            &lt;section className="heading">

                &lt;h1>Create New Player&lt;/h1>
                &lt;p>Please Fill Out the Form Below&lt;/p>
            &lt;/section>
            &lt;form onSubmit={onSubmit}>
            &lt;section className="form">
                &lt;div className="form-group">
                    &lt;label htmlFor="fullName">Player Name&lt;/label>
                    &lt;input type="text" 
                    className="form-control"
                    placeholder={fullName}
                    value={fullName} onChange={(e) => setPlayerName(e.target.value)} />
                &lt;/div>
                &lt;div className="form-group">
                    &lt;label htmlFor="team">team&lt;/label>
                    &lt;input type="text" 
                    className="form-control"
                    placeholder={team}
                    value={team} onChange={(e) => setPlayerTeam(e.target.value)}/>
                &lt;/div>
                &lt;div className="form-group">
                    &lt;label htmlFor="position">position&lt;/label>
                    &lt;input type="text" 
                    className="form-control"
                    placeholder={position}
                    value={position} onChange={(e) => setPlayerPosition(e.target.value)}/>
                &lt;/div>
                &lt;div className="form-group">
                    &lt;label htmlFor="raiting">rating&lt;/label>
                    &lt;input type="text" 
                    className="form-control"
                    placeholder={raiting}
                    value={raiting} onChange={(e) => setPlayerRaiting(e.target.value)}/>
                &lt;/div>
                    &lt;div className="form-group">
                        &lt;button className="btn btn-block">
                            Submit
                        &lt;/button>
                    &lt;/div>

                    &lt;/section>

                &lt;/form>
                &lt;div style={{ textAlign: "center" }}>
                &lt;h1>REACTJS CSV IMPORT EXAMPLE &lt;/h1>
                &lt;form>
                    &lt;input
                    type={"file"}
                    id={"csvFileInput"}
                    accept={".csv"}
                    onChange={handleOnChangeCSV}
                    />

                    &lt;button
                    onClick={(e) => {
                        handleOnSubmitCSV(e);
                    }}
                    >
                    IMPORT CSV
                    &lt;/button>
                &lt;/form>
                &lt;form onSubmit={onSubmitDB}>
                    &lt;div className="form-group">
                        &lt;button className="btn btn-block">
                            Submit to Database
                        &lt;/button>
                    &lt;/div>
                &lt;/form>
                

                &lt;br />

                &lt;table>
                    &lt;thead>
                    &lt;tr key={"header"}>
                        {headerKeys.map((key) => (
                        &lt;th>{key}&lt;/th>
                        ))}
                    &lt;/tr>
                    &lt;/thead>

                    &lt;tbody>
                    {array.map((item) => (
                        &lt;tr key={item.id}>
                        {Object.values(item).map((val) => (
                            &lt;td>{val}&lt;/td>
                        ))}
                        &lt;/tr>
                    ))}
                    &lt;/tbody>
                &lt;/table>
                &lt;/div>
            

        &lt;/>
    )

}

export default NewPlayer</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#NewPlayer">NewPlayer</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.0</a> on Tue Dec 13 2022 20:28:33 GMT+0300 (GMT+03:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
